# 项目结构说明

本文档详细说明了文档解析Demo项目的完整结构和各文件的作用。

## 项目目录结构

```
demo/
├── README.md                    # 项目使用说明文档
├── API_DOCUMENTATION.md         # API接口详细文档
├── PROJECT_STRUCTURE.md         # 项目结构说明（本文件）
├── backend/                     # 后端服务目录
│   ├── .env                     # 环境配置文件（需配置）
│   ├── env.example              # 环境配置示例文件
│   ├── package.json             # 后端依赖配置
│   ├── uploads/                 # 临时文件上传目录
│   └── src/                     # 后端源代码目录
│       ├── app.js               # 应用入口文件
│       ├── config/              # 配置文件目录
│       │   └── index.js         # 主配置文件
│       ├── routes/              # 路由文件目录
│       │   ├── fileRoutes.js    # 文件管理路由
│       │   ├── callbackRoutes.js # 回调处理路由
│       │   └── statusRoutes.js  # 状态查询路由
│       └── services/            # 服务层目录
│           ├── ossService.js    # OSS文件存储服务
│           ├── docParseService.js # 文档解析服务调用
│           └── storageService.js # 内存存储服务
└── frontend/                    # 前端应用目录
    ├── package.json             # 前端依赖配置
    ├── public/                  # 公共资源目录
    │   └── index.html           # HTML模板
    └── src/                     # 前端源代码目录
        ├── index.js             # 应用入口文件
        ├── index.css            # 全局基础样式
        ├── App.js               # 主应用组件
        ├── App.css              # 主应用样式
        ├── components/          # React组件目录
        │   ├── FileUpload.js    # 文件上传组件
        │   ├── FileList.js      # 文件列表组件
        │   └── StatusBoard.js   # 状态监控面板组件
        └── services/            # 前端服务目录
            └── apiService.js    # API调用服务
```

## 文件详细说明

### 根目录文件

#### README.md
- **作用**: 项目的主要说明文档
- **内容**: 安装指南、使用说明、配置方法、故障排除等
- **目标用户**: 开发者、运维人员、最终用户

#### API_DOCUMENTATION.md
- **作用**: 完整的API接口文档
- **内容**: 所有接口的详细说明、参数、响应格式、使用示例
- **目标用户**: 前端开发者、集成开发者

#### PROJECT_STRUCTURE.md
- **作用**: 项目结构和文件说明（本文件）
- **内容**: 目录结构、文件作用、技术架构说明
- **目标用户**: 开发者、维护人员

### 后端目录 (backend/)

#### 配置文件

**package.json**
- **作用**: Node.js项目配置文件
- **内容**: 依赖包、脚本命令、项目元信息
- **关键依赖**:
  - `express`: Web框架
  - `multer`: 文件上传处理
  - `ali-oss`: 阿里云OSS SDK
  - `axios`: HTTP客户端
  - `cors`: 跨域处理
  - `uuid`: UUID生成

**env.example / .env**
- **作用**: 环境变量配置
- **内容**: OSS配置、服务地址、认证信息等
- **注意**: `.env`文件包含敏感信息，不应提交到版本控制

#### 源代码文件

**src/app.js**
- **作用**: Express应用的入口文件
- **功能**:
  - 中间件配置（CORS、body-parser、multer）
  - 路由注册
  - 错误处理
  - 服务启动

**src/config/index.js**
- **作用**: 应用配置管理
- **功能**:
  - OSS配置管理
  - 文档解析服务配置
  - 支持的文件类型定义
  - 任务类型和状态映射

#### 路由文件 (routes/)

**fileRoutes.js**
- **作用**: 文件管理相关路由
- **接口**:
  - `POST /upload` - 文件上传
  - `GET /list` - 文件列表
  - `GET /:fileId` - 文件详情
  - `DELETE /:fileId` - 删除文件
  - `GET /:fileId/parsed-url` - 获取解析文件URL
  - `GET /stats` - 统计信息

**callbackRoutes.js**
- **作用**: 回调处理相关路由
- **接口**:
  - `POST /document` - 文档解析回调
  - `POST /test` - 测试回调
  - `POST /manual/:taskId` - 手动状态更新

**statusRoutes.js**
- **作用**: 状态查询相关路由
- **接口**:
  - `GET /task/:taskId` - 任务状态查询
  - `GET /file/:fileId` - 文件状态查询
  - `POST /batch` - 批量状态查询
  - `GET /stats` - 系统状态统计
  - `GET /health` - 健康检查

#### 服务文件 (services/)

**ossService.js**
- **作用**: 阿里云OSS文件存储服务
- **功能**:
  - 文件上传到OSS
  - 文件删除
  - 签名URL生成
  - 文件存在性检查

**docParseService.js**
- **作用**: 文档解析服务调用
- **功能**:
  - 调用dataentry服务解析文档
  - 任务状态查询
  - 文件类型判断和任务类型映射
  - 请求签名生成（如需要）

**storageService.js**
- **作用**: 内存存储管理服务
- **功能**:
  - 文件记录管理（包括 `targetPath` 和 `convertPages`）
  - 任务状态跟踪
  - 数据统计
  - 过期数据清理

### 前端目录 (frontend/)

#### 配置文件

**package.json**
- **作用**: React项目配置文件
- **内容**: 依赖包、构建脚本、代理配置
- **关键依赖**:
  - `react`: React框架
  - `antd`: Ant Design UI组件库
  - `axios`: HTTP客户端
  - `moment`: 时间处理库

#### 源代码文件

**src/index.js**
- **作用**: React应用入口文件
- **功能**:
  - React应用渲染
  - Ant Design配置
  - 中文本地化设置

**src/index.css**
- **作用**: 全局基础样式
- **内容**: 重置样式、工具类、响应式样式

**src/App.js**
- **作用**: 主应用组件
- **功能**:
  - 页面布局
  - 组件组合
  - 状态管理
  - 数据刷新控制

**src/App.css**
- **作用**: 主应用样式
- **内容**: 应用特定样式、组件样式、响应式设计

#### 组件文件 (components/)

**FileUpload.js**
- **作用**: 文件上传组件
- **功能**:
  - 拖拽上传支持
  - 文件类型和大小验证
  - 上传进度显示
  - 上传结果反馈

**FileList.js**
- **作用**: 文件列表组件
- **功能**:
  - 文件列表展示（包括 `convertPages` 等字段）
  - 分页和过滤
  - 文件详情查看
  - 获取解析文件URL
  - 文件删除操作
  - 状态实时更新

**StatusBoard.js**
- **作用**: 系统状态监控面板
- **功能**:
  - 文件处理统计
  - 系统信息展示
  - 实时数据更新
  - 状态警告提示

#### 服务文件 (services/)

**apiService.js**
- **作用**: API调用服务
- **功能**:
  - HTTP请求封装
  - 请求/响应拦截
  - 错误处理
  - 所有后端API接口的调用方法

## 技术架构

### 后端架构

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   前端应用      │────│   Express API    │────│   OSS存储       │
│   (React)       │    │   (Node.js)      │    │   (阿里云)      │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                              │
                              │
                       ┌──────────────────┐
                       │   文档解析服务   │
                       │   (dataentry)    │
                       └──────────────────┘
```

### 数据流程

```
1. 用户上传文件 → 2. 存储到OSS → 3. 调用解析服务 → 4. 返回任务ID
                                          │
5. 用户查看状态 ← 6. 更新本地状态 ← 7. 接收回调通知
```

### 状态管理

```
文件状态流转:
uploaded → parsing → completed/failed

任务状态同步:
本地状态 ⇄ 远程状态（可选同步）
```

## 扩展指南

### 添加新功能

1. **后端新接口**:
   - 在相应的routes文件中添加路由
   - 在services中实现业务逻辑
   - 更新API文档

2. **前端新组件**:
   - 在components目录创建新组件
   - 在App.js中集成
   - 添加对应的CSS样式

3. **新的文件类型支持**:
   - 更新config/index.js中的支持类型
   - 修改前端的文件过滤逻辑
   - 测试上传和解析流程

### 性能优化

1. **后端优化**:
   - 使用数据库替代内存存储
   - 添加缓存层（Redis）
   - 实现文件分片上传

2. **前端优化**:
   - 组件懒加载
   - 虚拟滚动（大量文件列表）
   - 状态更新防抖

### 部署优化

1. **容器化**:
   - 添加Dockerfile
   - 使用Docker Compose

2. **监控**:
   - 添加日志系统
   - 性能监控
   - 错误追踪

## 维护说明

### 日常维护

1. **日志监控**: 定期查看应用日志，关注错误和警告
2. **状态清理**: 定期清理过期的文件记录和临时文件
3. **性能监控**: 监控内存使用和响应时间
4. **安全更新**: 定期更新依赖包，修复安全漏洞

### 故障处理

1. **文件上传失败**: 检查OSS配置和网络连接
2. **解析服务异常**: 确认dataentry服务状态
3. **内存泄漏**: 监控内存使用，重启服务
4. **回调丢失**: 检查回调URL和网络配置

### 备份策略

1. **代码备份**: 使用Git版本控制
2. **配置备份**: 备份环境配置文件
3. **数据备份**: 如使用数据库，定期备份数据
4. **OSS备份**: 配置OSS的备份策略

## 版本信息

- **当前版本**: v1.0.0
- **创建日期**: 2024-09-10
- **最后更新**: 2024-09-10
- **维护状态**: 活跃开发中

## 联系信息

如有问题或建议，请通过以下方式联系：

- 项目仓库: [项目地址]
- 技术文档: 参见README.md和API_DOCUMENTATION.md
- 问题报告: [Issue地址]
